<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="./assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="./assets/img/favicon.png">
  <title> Material Dashboard </title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>

<body class="g-sidenav-show bg-gray-200">
  <aside data-load="components/sidemenu.html" class="sidenav navbar navbar-vertical navbar-expand-xs border-0 fixed-start   bg-gradient-light" id="sidenav-main"></aside>
  <div class="main-content position-relative max-height-vh-100 h-100">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" navbar-scroll="true">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="javascript:;">Pages</a></li>
            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">User Profile</li>
          </ol>
        </nav>

      </div>
    </nav>
    <!-- End Navbar -->
    <div class="container-fluid px-2 px-md-4">
      <div class="page-header min-height-300 border-radius-xl mt-4" style="background-image: url('https://images.unsplash.com/photo-1531512073830-ba890ca4eba2?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');">
        <span class="mask  bg-gradient-dark  opacity-6"></span>
      </div>
      <div class="card card-body  mt-n5 col-6 mx-auto shadow-xl ">
        <div class="row gx-4">
          <div class="col-auto my-auto">
            <div class="avatar avatar-xl position-relative">
              <img src="./images/profile2.png" alt="profile_image" class="w-100 rounded-circle shadow-warning ">
            </div>
          </div>
          <div class="col-auto my-auto">
            <div class="h-100">
              <h5 id="username" class="mb-1">
                Hi XXXXXX
              </h5>
              <p id="email" class="mb-0 font-weight-normal text-sm">
                user@email.com
              </p>
              <p id="nemail" class="mb-0 font-weight-normal text-sm">
                user@email.com
              </p>
              <p id="phone" class="mb-0 font-weight-normal text-sm">
                999-999-9999
              </p>
              <p id="userid" class="mb-0 font-weight-normal text-sm">
                -
              </p>
              <script type="text/javascript">
                $(document).ready(function() {
                  loadUserData = (data) => {
                    console.log(data);
                    $('#username').text('Hi '+data.name)
                    $('#email').text("Email: "+data.email)
                    $('#nemail').text("Notification Email: "+data.nemail)
                    $('#phone').text("Phone: "+data.phone)
                    // $('#nationality').text("nationality: "+data.nationality)
                    $('#userid').text("id: "+data._id)
                    window.userid=data._id
                    formprefill(data)
                  }

                  AJAX("GET",'/api/users/profile',data={},loadUserData);
                  
                });
              </script>
            </div>
          </div>
          <div class="col-auto mx-auto my-auto">
            <!-- <button class="btn btn-danger" Dialogue()">Update</button> -->
            <!-- <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#exampleModalCenter" >
              Update
            </button> -->
            <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#exampleModal">
              Edit Admin
            </button>

            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Enter Fields</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class=" mb-3">
                      <span class="">Name</span>
                      <input id="xname" type="name" autocomplete="on" class="form-control " name="name">
                    </div>
                    <div class=" mb-3">
                      <span class="">Email</span>
                      <input id="xemail" type="email" autocomplete="on" class="form-control " name="email" >
                    </div>                    
                    <div class=" mb-3">
                      <span class="">Notification Email</span>
                      <input id="xnemail" type="email" autocomplete="off" class="form-control " name="nemail" >
                    </div>
                    <div class=" mb-3">
                      <span class="">Phone</span>
                      <input id="xphone" type="tel" autocomplete="on" class="form-control " name="phone" >
                    </div>
                    <div class=" mb-3">
                      <span class="">Password</span>
                      <input id="xpassword" type="tel" autocomplete="on" class="form-control " name="password" >
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" onclick="updateUser(window.userid.toString())" >Save changes</button>
                  </div>
                </div>
              </div>
            </div>
            
            <script type="text/javascript">
              formprefill = (data) => {
                $('#xphone').val(data.phone)
                $('#xname').val(data.name)
                $('#xemail').val(data.email)
                $('#xnemail').val(data.nemail)
              }
              updateUser = (id) => {
                postdata={
                  name:$('#xname').val(),
                  email:$('#xemail').val(),
                  nemail:$('#xnemail').val(),
                  phone:$('#xphone').val(),
                  password:$('#xpassword').val(),
                }
                $.ajax({
                  type: "PUT",
                  contentType: "application/json",
                  url: '/api/users/profile/',
                  data: JSON.stringify(postdata),
                  headers:{'Authorization':`Bearer ${localStorage.getItem('jwt')}`},
                  dataType: "json",
                  success: (data,textstatus,xhr)=>{
                    Swal.fire(
                      "User Updated",
                      JSON.stringify(data.responseText),
                      'success'
                      ).then(()=>{window.location = ""})
                    
                  },
                  error: (data,textstatus,xhr)=>{
                    Swal.fire(
                      "User Not Updated",
                      JSON.stringify(data.responseText),
                      'error'
                      )
                  }
                });
              }
            </script>
          </div>

          
          
        </div>
        
      </div>
    </div>
    <footer class="footer py-4"></footer>
  </div>
  

  <!-- DATATABLES -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css"/>
  <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
  <!-- CSS -->

  <!--   BOOTSTRAP   -->
  
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.1/js/bootstrap.bundle.min.js" integrity="sha512-sH8JPhKJUeA9PWk3eOcOl8U+lfZTgtBXD41q6cO/slwxGHCxKcW45K4oPCUhHG7NMB4mbKEddVmPuTXtpbCbFA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.1/css/bootstrap.min.css" integrity="sha512-Ez0cGzNzHR1tYAv56860NLspgUGuQw16GiOOp/I2LuTmpSK9xDXlgJz3XN4cnpXWDmkNBKXR/VDMTCnAaEooxA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script type="module" src="./assets/js/swamix.js"  ></script>
  <link id="pagestyle" href="./assets/css/material-dashboard.css?v=3.0.1" rel="stylesheet" />



  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="./assets/js/material-dashboard.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" >
</body>

</html>